{% extends "base.html" %}

{% block content %}
<h1>Book {{ campervan.name }}</h1>

<div style="border: 1px solid #ddd; padding: 16px; margin-bottom: 20px;">
    <h2>{{ campervan.name }}</h2>
    <p><strong>Brand:</strong> {{ campervan.brand }}</p>
    <p><strong>Model:</strong> {{ campervan.model }}</p>
    <p><strong>Description:</strong> {{ campervan.description }}</p>
    <p><strong>Price per Day:</strong> ${{ campervan.price_per_day }}</p>
    <p><strong>Capacity:</strong> {{ campervan.capacity }} people</p>

    {% if campervan.image %}
        <img src="{{ campervan.image.url }}" alt="{{ campervan.name }}" class="img-fluid" width="300">
    {% endif %}
</div>

<form method="post">
    {% csrf_token %}
    <div>
        <label for="start_date">Start Date:</label>
        <input type="date" id="start_date" name="start_date" required>
    </div>
    <div>
        <label for="end_date">End Date:</label>
        <input type="date" id="end_date" name="end_date" required>
    </div>
    <div>
        <p><strong>Total Price:</strong> $<span id="total_price">0.00</span></p>
    </div>
    <button type="submit" style="padding: 10px 20px;">Confirm Booking</button>
</form>

<a href="{% url 'campervan_list' %}" style="display: block; margin-top: 20px;">Back to Listings</a>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const startDateInput = document.getElementById('start_date');
        const endDateInput = document.getElementById('end_date');
        const totalPriceDisplay = document.getElementById('total_price');
        const pricePerDay = parseFloat('{{ campervan.price_per_day }}'); // Parse as float for calculation

        // Function to calculate the total price
        function calculateTotalPrice() {
            // Parse input values
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);

            // Check if the dates are valid
            if (isNaN(startDate) || isNaN(endDate) || endDate <= startDate) {
                totalPriceDisplay.textContent = "0.00";
                return;
            }

            // Calculate the total days and price
            const timeDifference = endDate - startDate;
            const days = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));
            const totalPrice = days * pricePerDay;

            totalPriceDisplay.textContent = totalPrice.toFixed(2); // Format as 2 decimal places
        }

        // Add event listeners for both date inputs
        startDateInput.addEventListener('change', calculateTotalPrice);
        endDateInput.addEventListener('change', calculateTotalPrice);
    });
</script>
{% endblock %}
